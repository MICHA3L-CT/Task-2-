@model IEnumerable<CityPointWeb.Models.Room>
@{
    ViewData["Title"] = "Rooms";
}

@section Styles {
    <link rel="stylesheet" href="~/css/rooms.css" />
}

<!-- Page Header with Floating Effect -->
<div class="page-header-room">
    <div class="page-header-overlay"></div>
    <div class="container-fluid">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h1 class="page-title-room">
                    <i class="bi bi-door-open-fill"></i> Our Rooms
                </h1>
                <p class="page-subtitle-room">Browse and manage available spaces</p>
            </div>
            <div class="col-md-6 text-md-end">
                @* Only show Create button to Admins *@
                @if (User.IsInRole("Admin"))
                {
                    <a asp-action="Create" class="btn-primary-room">
                        <i class="bi bi-plus-circle-fill"></i> Create New Room
                    </a>
                }
            </div>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="rooms-main-content">
    <div class="container-fluid">

        <!-- Filter Card with Floating Effect -->
        <div class="filter-card-room">
            <div class="filter-header-room">
                <h5 class="filter-title-room">
                    <button class="filter-toggle-room" type="button" data-bs-toggle="collapse" data-bs-target="#filterCollapse" aria-expanded="true">
                        <i class="bi bi-funnel-fill"></i> Filters
                        <i class="bi bi-chevron-down toggle-icon-room"></i>
                    </button>
                </h5>
            </div>
            <div class="collapse show" id="filterCollapse">
                <div class="filter-body-room">
                    <form asp-action="Index" method="get">
                        <div class="row g-3">
                            <!-- Search -->
                            <div class="col-md-6">
                                <label for="searchString" class="form-label-room">
                                    <i class="bi bi-search"></i> Search
                                </label>
                                <input type="text" class="form-control-room" id="searchString" name="searchString"
                                       value="@ViewData["CurrentFilter"]" placeholder="Search by name or description...">
                            </div>

                            <!-- Availability -->
                            <div class="col-md-6">
                                <label for="isAvailable" class="form-label-room">
                                    <i class="bi bi-check-circle-fill"></i> Availability
                                </label>
                                <select class="form-select-room" id="isAvailable" name="isAvailable">
                                    <option value="">All Rooms</option>
                                    <option value="true" selected="@(ViewData["IsAvailable"]?.ToString() == "True")">Available Only</option>
                                    <option value="false" selected="@(ViewData["IsAvailable"]?.ToString() == "False")">Unavailable Only</option>
                                </select>
                            </div>

                            <!-- Min Capacity -->
                            <div class="col-md-3">
                                <label for="minCapacity" class="form-label-room">
                                    <i class="bi bi-people-fill"></i> Min Capacity
                                </label>
                                <input type="number" class="form-control-room" id="minCapacity" name="minCapacity"
                                       value="@ViewData["MinCapacity"]" placeholder="1" min="1">
                            </div>

                            <!-- Max Capacity -->
                            <div class="col-md-3">
                                <label for="maxCapacity" class="form-label-room">
                                    <i class="bi bi-people-fill"></i> Max Capacity
                                </label>
                                <input type="number" class="form-control-room" id="maxCapacity" name="maxCapacity"
                                       value="@ViewData["MaxCapacity"]" placeholder="10" min="1">
                            </div>

                            <!-- Min Price -->
                            <div class="col-md-3">
                                <label for="minPrice" class="form-label-room">
                                    <i class="bi bi-currency-pound"></i> Min Price
                                </label>
                                <input type="number" class="form-control-room" id="minPrice" name="minPrice"
                                       value="@ViewData["MinPrice"]" placeholder="0" min="0" step="0.01">
                            </div>

                            <!-- Max Price -->
                            <div class="col-md-3">
                                <label for="maxPrice" class="form-label-room">
                                    <i class="bi bi-currency-pound"></i> Max Price
                                </label>
                                <input type="number" class="form-control-room" id="maxPrice" name="maxPrice"
                                       value="@ViewData["MaxPrice"]" placeholder="1000" min="0" step="0.01">
                            </div>

                            <!-- Buttons -->
                            <div class="col-12">
                                <div class="filter-actions-room">
                                    <button type="submit" class="btn-primary-room">
                                        <i class="bi bi-search"></i> Apply Filters
                                    </button>
                                    <a asp-action="Index" class="btn-secondary-room">
                                        <i class="bi bi-x-circle-fill"></i> Clear Filters
                                    </a>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Results Section with Floating Effect -->
        <div class="results-card-room">
            <div class="results-header-room">
                <h5 class="results-count-room">
                    <i class="bi bi-list-check"></i> Showing @Model.Count() room(s)
                </h5>
            </div>

            <!-- Desktop Table View -->
            <div class="table-responsive d-none d-lg-block">
                <table class="rooms-table">
                    <thead>
                        <tr>
                            <th>
                                <a asp-action="Index" asp-route-sortOrder="@ViewData["NameSortParm"]"
                                   asp-route-searchString="@ViewData["CurrentFilter"]"
                                   asp-route-minCapacity="@ViewData["MinCapacity"]"
                                   asp-route-maxCapacity="@ViewData["MaxCapacity"]"
                                   asp-route-minPrice="@ViewData["MinPrice"]"
                                   asp-route-maxPrice="@ViewData["MaxPrice"]"
                                   asp-route-isAvailable="@ViewData["IsAvailable"]"
                                   class="sort-link-room">
                                    Room Name <i class="bi bi-arrow-down-up"></i>
                                </a>
                            </th>
                            <th>
                                <a asp-action="Index" asp-route-sortOrder="@ViewData["RoomNumberSortParm"]"
                                   asp-route-searchString="@ViewData["CurrentFilter"]"
                                   asp-route-minCapacity="@ViewData["MinCapacity"]"
                                   asp-route-maxCapacity="@ViewData["MaxCapacity"]"
                                   asp-route-minPrice="@ViewData["MinPrice"]"
                                   asp-route-maxPrice="@ViewData["MaxPrice"]"
                                   asp-route-isAvailable="@ViewData["IsAvailable"]"
                                   class="sort-link-room">
                                    Room # <i class="bi bi-arrow-down-up"></i>
                                </a>
                            </th>
                            <th>
                                <a asp-action="Index" asp-route-sortOrder="@ViewData["CapacitySortParm"]"
                                   asp-route-searchString="@ViewData["CurrentFilter"]"
                                   asp-route-minCapacity="@ViewData["MinCapacity"]"
                                   asp-route-maxCapacity="@ViewData["MaxCapacity"]"
                                   asp-route-minPrice="@ViewData["MinPrice"]"
                                   asp-route-maxPrice="@ViewData["MaxPrice"]"
                                   asp-route-isAvailable="@ViewData["IsAvailable"]"
                                   class="sort-link-room">
                                    Capacity <i class="bi bi-arrow-down-up"></i>
                                </a>
                            </th>
                            <th>Description</th>
                            <th>
                                <a asp-action="Index" asp-route-sortOrder="@ViewData["PriceSortParm"]"
                                   asp-route-searchString="@ViewData["CurrentFilter"]"
                                   asp-route-minCapacity="@ViewData["MinCapacity"]"
                                   asp-route-maxCapacity="@ViewData["MaxCapacity"]"
                                   asp-route-minPrice="@ViewData["MinPrice"]"
                                   asp-route-maxPrice="@ViewData["MaxPrice"]"
                                   asp-route-isAvailable="@ViewData["IsAvailable"]"
                                   class="sort-link-room">
                                    Price/Night <i class="bi bi-arrow-down-up"></i>
                                </a>
                            </th>
                            <th>Size</th>
                            <th>Status</th>
                            @* Only show Actions column if user is Admin *@
                            @if (User.IsInRole("Admin"))
                            {
                                <th>Actions</th>
                            }
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model != null && Model.Any())
                        {
                            foreach (var item in Model)
                            {
                                <tr class="room-row">
                                    <td class="room-name-cell"><strong>@item.RoomName</strong></td>
                                    <td><span class="room-number-badge">@item.Roomumber</span></td>
                                    <td><i class="bi bi-people-fill"></i> @item.Capacity</td>
                                    <td class="description-cell-room">@item.Description</td>
                                    <td><span class="price-room">£@item.PricePerNight</span></td>
                                    <td><i class="bi bi-arrows-fullscreen"></i> @item.RoomSize m²</td>
                                    <td>
                                        @if (item.IsAvailable)
                                        {
                                            <span class="badge-available-room">
                                                <i class="bi bi-check-circle-fill"></i> Available
                                            </span>
                                        }
                                        else
                                        {
                                            <span class="badge-unavailable-room">
                                                <i class="bi bi-x-circle-fill"></i> Unavailable
                                            </span>
                                        }
                                    </td>
                                    @* Only show action buttons if user is Admin *@
                                    @if (User.IsInRole("Admin"))
                                    {
                                        <td>
                                            <div class="action-buttons-room">
                                                <a asp-action="Details" asp-route-id="@item.RoomId" class="btn-action-room btn-info-room" title="View Details">
                                                    <i class="bi bi-eye-fill"></i>
                                                </a>
                                                <a asp-action="Edit" asp-route-id="@item.RoomId" class="btn-action-room btn-edit-room" title="Edit">
                                                    <i class="bi bi-pencil-fill"></i>
                                                </a>
                                                <a asp-action="Delete" asp-route-id="@item.RoomId" class="btn-action-room btn-delete-room" title="Delete">
                                                    <i class="bi bi-trash-fill"></i>
                                                </a>
                                            </div>
                                        </td>
                                    }
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="@(User.IsInRole("Admin") ? "8" : "7")">
                                    <div class="empty-state-room">
                                        <i class="bi bi-inbox"></i>
                                        <p>No rooms found matching the current filters.</p>
                                        <a asp-action="Index" class="btn-secondary-room btn-sm">Clear Filters</a>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <!-- Mobile Card View -->
            <div class="d-lg-none">
                @if (Model != null && Model.Any())
                {
                    foreach (var item in Model)
                    {
                        <div class="room-card-mobile">
                            <div class="room-card-header-mobile">
                                <h5 class="room-card-title-mobile">@item.RoomName</h5>
                                @if (item.IsAvailable)
                                {
                                    <span class="badge-available-room">
                                        <i class="bi bi-check-circle-fill"></i> Available
                                    </span>
                                }
                                else
                                {
                                    <span class="badge-unavailable-room">
                                        <i class="bi bi-x-circle-fill"></i> Unavailable
                                    </span>
                                }
                            </div>
                            <div class="room-card-body-mobile">
                                <div class="room-info-mobile">
                                    <span class="info-item-mobile">
                                        <i class="bi bi-hash"></i> Room @item.Roomumber
                                    </span>
                                    <span class="info-item-mobile">
                                        <i class="bi bi-people-fill"></i> @item.Capacity People
                                    </span>
                                    <span class="info-item-mobile">
                                        <i class="bi bi-arrows-fullscreen"></i> @item.RoomSize m²
                                    </span>
                                </div>
                                <p class="room-description-mobile">@item.Description</p>
                                <div class="room-price-mobile">
                                    <span class="price-label-mobile">Price per night:</span>
                                    <span class="price-room">£@item.PricePerNight</span>
                                </div>
                            </div>
                            @* Only show action buttons if user is Admin *@
                            @if (User.IsInRole("Admin"))
                            {
                                <div class="room-card-footer-mobile">
                                    <a asp-action="Details" asp-route-id="@item.RoomId" class="btn-primary-room btn-sm">
                                        <i class="bi bi-eye-fill"></i> Details
                                    </a>
                                    <a asp-action="Edit" asp-route-id="@item.RoomId" class="btn-edit-room-mobile btn-sm">
                                        <i class="bi bi-pencil-fill"></i> Edit
                                    </a>
                                    <a asp-action="Delete" asp-route-id="@item.RoomId" class="btn-delete-room-mobile btn-sm">
                                        <i class="bi bi-trash-fill"></i> Delete
                                    </a>
                                </div>
                            }
                            else
                            {
                                <div class="room-card-footer-mobile">
                                    <a asp-action="Details" asp-route-id="@item.RoomId" class="btn-primary-room btn-sm">
                                        <i class="bi bi-eye-fill"></i> View Details
                                    </a>
                                </div>
                            }
                        </div>
                    }
                }
                else
                {
                    <div class="empty-state-mobile-room">
                        <i class="bi bi-inbox"></i>
                        <p>No rooms found matching the current filters.</p>
                        <a asp-action="Index" class="btn-secondary-room">Clear Filters</a>
                    </div>
                }
            </div>
        </div>

    </div>
</div>

@section Scripts {
    <script src="~/js/rooms.js"></script>
}
