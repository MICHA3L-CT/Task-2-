@model IEnumerable<CityPointWeb.Models.Room>
@{
    ViewData["Title"] = "Rooms";
}

<h1>Rooms</h1>

<p>
    <a asp-action="Create" class="btn btn-primary">Create New Room</a>
</p>

<!-- Filter Section -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">
            <button class="btn btn-link" type="button" data-bs-toggle="collapse" data-bs-target="#filterCollapse">
                <i class="bi bi-funnel"></i> Filters
            </button>
        </h5>
    </div>
    <div class="collapse show" id="filterCollapse">
        <div class="card-body">
            <form asp-action="Index" method="get">
                <div class="row g-3">
                    <!-- Search -->
                    <div class="col-md-6">
                        <label for="searchString" class="form-label">Search (Name/Description)</label>
                        <input type="text" class="form-control" id="searchString" name="searchString" 
                               value="@ViewData["CurrentFilter"]" placeholder="Search rooms...">
                    </div>

                    <!-- Availability -->
                    <div class="col-md-6">
                        <label for="isAvailable" class="form-label">Availability</label>
                        <select class="form-select" id="isAvailable" name="isAvailable">
                            <option value="">All Rooms</option>
                            <option value="true" selected="@(ViewData["IsAvailable"]?.ToString() == "True")">Available Only</option>
                            <option value="false" selected="@(ViewData["IsAvailable"]?.ToString() == "False")">Unavailable Only</option>
                        </select>
                    </div>

                    <!-- Min Capacity -->
                    <div class="col-md-3">
                        <label for="minCapacity" class="form-label">Min Capacity</label>
                        <input type="number" class="form-control" id="minCapacity" name="minCapacity" 
                               value="@ViewData["MinCapacity"]" placeholder="1" min="1">
                    </div>

                    <!-- Max Capacity -->
                    <div class="col-md-3">
                        <label for="maxCapacity" class="form-label">Max Capacity</label>
                        <input type="number" class="form-control" id="maxCapacity" name="maxCapacity" 
                               value="@ViewData["MaxCapacity"]" placeholder="10" min="1">
                    </div>

                    <!-- Min Price -->
                    <div class="col-md-3">
                        <label for="minPrice" class="form-label">Min Price (£)</label>
                        <input type="number" class="form-control" id="minPrice" name="minPrice" 
                               value="@ViewData["MinPrice"]" placeholder="0" min="0" step="0.01">
                    </div>

                    <!-- Max Price -->
                    <div class="col-md-3">
                        <label for="maxPrice" class="form-label">Max Price (£)</label>
                        <input type="number" class="form-control" id="maxPrice" name="maxPrice" 
                               value="@ViewData["MaxPrice"]" placeholder="1000" min="0" step="0.01">
                    </div>

                    <!-- Buttons -->
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-search"></i> Apply Filters
                        </button>
                        <a asp-action="Index" class="btn btn-secondary">
                            <i class="bi bi-x-circle"></i> Clear Filters
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Results Table -->
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>
                    <a asp-action="Index" asp-route-sortOrder="@ViewData["NameSortParm"]"
                       asp-route-searchString="@ViewData["CurrentFilter"]"
                       asp-route-minCapacity="@ViewData["MinCapacity"]"
                       asp-route-maxCapacity="@ViewData["MaxCapacity"]"
                       asp-route-minPrice="@ViewData["MinPrice"]"
                       asp-route-maxPrice="@ViewData["MaxPrice"]"
                       asp-route-isAvailable="@ViewData["IsAvailable"]">
                        @Html.DisplayNameFor(model => model.RoomName)
                        <i class="bi bi-arrow-down-up"></i>
                    </a>
                </th>
                <th>
                    <a asp-action="Index" asp-route-sortOrder="@ViewData["RoomNumberSortParm"]"
                       asp-route-searchString="@ViewData["CurrentFilter"]"
                       asp-route-minCapacity="@ViewData["MinCapacity"]"
                       asp-route-maxCapacity="@ViewData["MaxCapacity"]"
                       asp-route-minPrice="@ViewData["MinPrice"]"
                       asp-route-maxPrice="@ViewData["MaxPrice"]"
                       asp-route-isAvailable="@ViewData["IsAvailable"]">
                        @Html.DisplayNameFor(model => model.Roomumber)
                        <i class="bi bi-arrow-down-up"></i>
                    </a>
                </th>
                <th>
                    <a asp-action="Index" asp-route-sortOrder="@ViewData["CapacitySortParm"]"
                       asp-route-searchString="@ViewData["CurrentFilter"]"
                       asp-route-minCapacity="@ViewData["MinCapacity"]"
                       asp-route-maxCapacity="@ViewData["MaxCapacity"]"
                       asp-route-minPrice="@ViewData["MinPrice"]"
                       asp-route-maxPrice="@ViewData["MaxPrice"]"
                       asp-route-isAvailable="@ViewData["IsAvailable"]">
                        @Html.DisplayNameFor(model => model.Capacity)
                        <i class="bi bi-arrow-down-up"></i>
                    </a>
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Description)
                </th>
                <th>
                    <a asp-action="Index" asp-route-sortOrder="@ViewData["PriceSortParm"]"
                       asp-route-searchString="@ViewData["CurrentFilter"]"
                       asp-route-minCapacity="@ViewData["MinCapacity"]"
                       asp-route-maxCapacity="@ViewData["MaxCapacity"]"
                       asp-route-minPrice="@ViewData["MinPrice"]"
                       asp-route-maxPrice="@ViewData["MaxPrice"]"
                       asp-route-isAvailable="@ViewData["IsAvailable"]">
                        @Html.DisplayNameFor(model => model.PricePerNight)
                        <i class="bi bi-arrow-down-up"></i>
                    </a>
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.RoomSize)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.IsAvailable)
                </th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.Any())
            {
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@Html.DisplayFor(modelItem => item.RoomName)</td>
                        <td>@Html.DisplayFor(modelItem => item.Roomumber)</td>
                        <td>@Html.DisplayFor(modelItem => item.Capacity)</td>
                        <td>@Html.DisplayFor(modelItem => item.Description)</td>
                        <td>£@Html.DisplayFor(modelItem => item.PricePerNight)</td>
                        <td>@Html.DisplayFor(modelItem => item.RoomSize) m²</td>
                        <td>
                            @if (item.IsAvailable)
                            {
                                <span class="badge bg-success">Available</span>
                            }
                            else
                            {
                                <span class="badge bg-danger">Unavailable</span>
                            }
                        </td>
                        <td>
                            <a asp-action="Edit" asp-route-id="@item.RoomId" class="btn btn-sm btn-warning">Edit</a>
                            <a asp-action="Details" asp-route-id="@item.RoomId" class="btn btn-sm btn-info">Details</a>
                            <a asp-action="Delete" asp-route-id="@item.RoomId" class="btn btn-sm btn-danger">Delete</a>
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="8" class="text-center">No rooms found matching the current filters.</td>
                </tr>
            }
        </tbody>
    </table>
</div>

<div class="mt-3">
    <small class="text-muted">Showing @Model.Count() room(s)</small>
</div>